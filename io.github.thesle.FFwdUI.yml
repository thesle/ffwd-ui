app-id: io.github.thesle.FFwdUI
runtime: org.gnome.Platform
runtime-version: '49'
sdk: org.gnome.Sdk
command: ffwd-ui
finish-args:
  - --share=ipc
  - --share=network
  - --socket=x11
  - --socket=wayland
  - --socket=pulseaudio
  - --device=dri
  - --device=all
  - --filesystem=home
  - --filesystem=xdg-documents
  - --filesystem=xdg-videos
  - --filesystem=xdg-music
  - --filesystem=xdg-download
  - --env=WEBKIT_DISABLE_COMPOSITING_MODE=1

modules:
  - name: golang
    buildsystem: simple
    build-commands:
      - cp -r go /app/
      - mkdir -p /app/bin
      - ln -s /app/go/bin/go /app/bin/go
      - ln -s /app/go/bin/gofmt /app/bin/gofmt
    sources:
      - type: archive
        url: https://go.dev/dl/go1.23.4.linux-amd64.tar.gz
        sha256: 6924efde5de86fe277676e929dc9917d466efa02fb934197bc2eba35d5680971
        only-arches:
          - x86_64
        strip-components: 0

  # Use shared-modules prebuilt FFmpeg with all codecs
  - shared-modules/ffmpeg/ffmpeg.json

  - name: nodejs
    buildsystem: simple
    build-commands:
      - mkdir -p /app/lib
      - cp -r . /app/lib/nodejs
      - ln -s /app/lib/nodejs/bin/node /app/bin/node
      - ln -s /app/lib/nodejs/bin/npm /app/bin/npm
      - ln -s /app/lib/nodejs/bin/npx /app/bin/npx
    sources:
      - type: archive
        url: https://nodejs.org/dist/v20.11.0/node-v20.11.0-linux-x64.tar.xz
        sha256: 822780369d0ea309e7d218e41debbd1a03f8cdf354ebf8a4420e89f39cc2e612
        only-arches:
          - x86_64
        strip-components: 1

  - name: ffwd-ui
    buildsystem: simple
    build-commands:
      - install -Dm755 ffwd-ui /app/bin/ffwd-ui
      - install -Dm644 io.github.thesle.FFwdUI.desktop /app/share/applications/io.github.thesle.FFwdUI.desktop
      - install -Dm644 io.github.thesle.FFwdUI.metainfo.xml /app/share/metainfo/io.github.thesle.FFwdUI.metainfo.xml
      - install -Dm644 appicon.png /app/share/icons/hicolor/512x512/apps/io.github.thesle.FFwdUI.png
    sources:
      - type: file
        path: build/bin/ffwd-ui
      - type: file
        path: io.github.thesle.FFwdUI.desktop
      - type: file
        path: io.github.thesle.FFwdUI.metainfo.xml
      - type: file
        path: build/appicon.png
        dest-filename: appicon.png
